import{j as e}from"./radix-ui-BhA1LbKn.js";import{u as a,r as s}from"./react-vendor-B1bUijmx.js";import{u as i,C as r,b as t,d as l,f as n,e as o,B as d,s as c,t as m}from"./index-CRPRT7Ob.js";import{u as p}from"./useUserProfile-DDFCyQZj.js";import{I as u}from"./input-BBdXW6UI.js";import{L as h}from"./label-bVOoOlT-.js";import{T as x}from"./textarea-BWoK1MqN.js";import{T as j,a as f,b as v,c as g}from"./tabs-CN3XS-3r.js";import{S as N}from"./shield-D66hZTXg.js";import{L as w}from"./loader-circle-Ck_Ta4Y7.js";import"./supabase-C_IPIGZD.js";import"./utils-DjG4pwKl.js";function b(){const{user:b}=i(),{profile:y,isLoading:S}=p(),A=a(),[E,C]=s.useState(!1),[F,R]=s.useState(!1),[k,q]=s.useState(""),[P,L]=s.useState({email:"",password:"",firstName:"",lastName:"",applicationReason:""});if(s.useEffect(()=>{b&&!S&&y&&("admin"===y.role&&y.is_verified?A("/admin-dashboard"):A("/dashboard"))},[b,y,S,A]),b&&S)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-600 via-purple-700 to-purple-800 flex items-center justify-center",children:e.jsx("div",{className:"text-white",children:"Loading..."})});const _=e=>{L({...P,[e.target.name]:e.target.value})},D=async e=>{e.preventDefault(),C(!0);try{const{error:e}=await c.auth.resetPasswordForEmail(k,{redirectTo:`${window.location.origin}/admin-auth`});e?m({title:"Error",description:e.message,variant:"destructive"}):(m({title:"Reset link sent!",description:"Check your email for the password reset link."}),R(!1),q(""))}catch(a){m({title:"Error",description:"An unexpected error occurred.",variant:"destructive"})}finally{C(!1)}};return F?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-600 via-purple-700 to-purple-800 flex items-center justify-center p-4",children:e.jsxs(r,{className:"w-full max-w-md",children:[e.jsxs(t,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4",children:e.jsx(N,{className:"w-20 h-20 mx-auto text-purple-600"})}),e.jsx(l,{className:"text-2xl font-bold text-purple-800",children:"Reset Admin Password"}),e.jsx(n,{children:"Enter your email to receive a reset link"})]}),e.jsx(o,{children:e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"forgotEmail",children:"Email"}),e.jsx(u,{id:"forgotEmail",type:"email",placeholder:"admin@nugsa.de",value:k,onChange:e=>q(e.target.value),required:!0})]}),e.jsxs(d,{type:"submit",className:"w-full bg-purple-600 hover:bg-purple-700",disabled:E,children:[E&&e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}),"Send Reset Link"]}),e.jsx(d,{type:"button",variant:"ghost",className:"w-full",onClick:()=>R(!1),children:"Back to Sign In"})]})})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-600 via-purple-700 to-purple-800 flex items-center justify-center p-4",children:e.jsxs(r,{className:"w-full max-w-2xl",children:[e.jsxs(t,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4",children:e.jsx(N,{className:"w-20 h-20 mx-auto text-purple-600"})}),e.jsx(l,{className:"text-2xl font-bold text-purple-800",children:"Admin Portal"}),e.jsx(n,{children:"NUGSA - Germany Executive Management System"})]}),e.jsx(o,{children:e.jsxs(j,{defaultValue:"signin",className:"w-full",children:[e.jsx(f,{className:"grid w-full grid-cols-2",children:e.jsx(v,{value:"signin",children:"Sign In"})}),e.jsx(g,{value:"signin",children:e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),C(!0);try{const{error:e}=await c.auth.signInWithPassword({email:P.email,password:P.password});m(e?{title:"Sign in failed",description:e.message,variant:"destructive"}:{title:"Welcome back!",description:"Redirecting to admin dashboard..."})}catch(a){m({title:"Error",description:"An unexpected error occurred.",variant:"destructive"})}finally{C(!1)}},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"email",children:"Email"}),e.jsx(u,{id:"email",name:"email",type:"email",placeholder:"admin@nugsa.de",value:P.email,onChange:_,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"password",children:"Password"}),e.jsx(u,{id:"password",name:"password",type:"password",value:P.password,onChange:_,required:!0})]}),e.jsxs(d,{type:"submit",className:"w-full bg-purple-600 hover:bg-purple-700",disabled:E,children:[E&&e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}),"Sign In to Admin Dashboard"]}),e.jsx(d,{type:"button",variant:"ghost",className:"w-full text-sm",onClick:()=>R(!0),children:"Forgot your password?"})]})}),e.jsx(g,{value:"apply",children:e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),C(!0);try{const{data:e,error:a}=await c.auth.signUp({email:P.email,password:P.password,options:{emailRedirectTo:`${window.location.origin}/admin-dashboard`,data:{first_name:P.firstName,last_name:P.lastName,role:"admin"}}});if(a)return void m({title:"Sign up failed",description:a.message,variant:"destructive"});if(e.user){const{error:a}=await c.from("admin_approvals").insert({applicant_id:e.user.id,application_reason:P.applicationReason});m(a?{title:"Application failed",description:"Failed to submit admin application.",variant:"destructive"}:{title:"Application Submitted",description:"Your admin application has been submitted for review. You'll be notified once it's approved."})}}catch(a){m({title:"Error",description:"An unexpected error occurred.",variant:"destructive"})}finally{C(!1)}},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"firstName",children:"First Name"}),e.jsx(u,{id:"firstName",name:"firstName",type:"text",value:P.firstName,onChange:_,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"lastName",children:"Last Name"}),e.jsx(u,{id:"lastName",name:"lastName",type:"text",value:P.lastName,onChange:_,required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"email",children:"Email"}),e.jsx(u,{id:"email",name:"email",type:"email",placeholder:"your.email@example.com",value:P.email,onChange:_,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"password",children:"Password"}),e.jsx(u,{id:"password",name:"password",type:"password",value:P.password,onChange:_,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"applicationReason",children:"Why do you want to become an admin?"}),e.jsx(x,{id:"applicationReason",name:"applicationReason",placeholder:"Please explain your motivation and qualifications for becoming a NUGSA - Germany admin...",value:P.applicationReason,onChange:_,rows:4,required:!0})]}),e.jsxs(d,{type:"submit",className:"w-full bg-purple-600 hover:bg-purple-700",disabled:E,children:[E&&e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}),"Submit Admin Application"]}),e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Your application will be reviewed by existing admins before you can access the admin dashboard."})]})})]})})]})})}export{b as default};
