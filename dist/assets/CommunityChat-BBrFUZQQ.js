import{j as e}from"./radix-ui-C_30fW44.js";import{r as s}from"./react-vendor-BPKX_lDx.js";import{u as a,s as t,C as r,a as l,b as n,d as i,B as c,L as m,t as d}from"./index-ZrmUALcR.js";import{I as o}from"./input-B4xn1GWc.js";import{S as x}from"./scroll-area-nrxbuVoD.js";import{A as u,a as f,b as h}from"./avatar-DlUzrqvh.js";import{M as j}from"./message-circle-CRT3VB5N.js";import{U as p}from"./users-DjGvqPV5.js";import{f as g}from"./utils-DDMI54vX.js";import{S as v}from"./send-Cck2jNa4.js";import"./supabase-bi29EmR8.js";function N(){const{user:N}=a(),[b,y]=s.useState([]),[w,_]=s.useState(""),[S,C]=s.useState(!0),[A,E]=s.useState(!1),[I,M]=s.useState(0),R=s.useRef(null),k=s.useRef(null);s.useEffect(()=>{G(),L(),M(Math.floor(50*Math.random())+20)},[]),s.useEffect(()=>{B()},[b]);const B=()=>{var e;null==(e=R.current)||e.scrollIntoView({behavior:"smooth"})},G=async()=>{try{const{data:e,error:s}=await t.from("community_messages").select("\n          id,\n          content,\n          created_at,\n          sender:sender_id (\n            id,\n            first_name,\n            last_name,\n            profile_image_url,\n            role\n          )\n        ").order("created_at",{ascending:!0}).limit(100);if(s)throw s;y(e||[])}catch(e){}finally{C(!1)}},L=()=>{const e=t.channel("community-chat").on("postgres_changes",{event:"INSERT",schema:"public",table:"community_messages"},e=>{G()}).subscribe();return()=>{t.removeChannel(e)}};return N?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(r,{className:"mb-4",children:e.jsx(l,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center",children:e.jsx(j,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx(n,{className:"text-xl",children:"NUGSA - Germany Community Chat"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connect with fellow students and admins"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx(p,{className:"w-4 h-4"}),e.jsxs("span",{children:[I," online"]})]})]})})}),e.jsx(r,{className:"h-[calc(100vh-200px)] flex flex-col",children:e.jsxs(i,{className:"flex-1 flex flex-col p-0",children:[e.jsx(x,{className:"flex-1 p-4",ref:k,children:S?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(m,{size:"sm"})}):0===b.length?e.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[e.jsx(j,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No messages yet. Be the first to start the conversation!"})]}):e.jsxs("div",{className:"space-y-4",children:[b.map(s=>{var a,t,r,l,n,i,c,m,d;const o=(null==(a=s.sender)?void 0:a.id)===N.id;return e.jsxs("div",{className:"flex gap-3 "+(o?"flex-row-reverse":"flex-row"),children:[e.jsxs(u,{className:"w-8 h-8 flex-shrink-0",children:[e.jsx(f,{src:null==(t=s.sender)?void 0:t.profile_image_url}),e.jsxs(h,{className:"text-xs",children:[null==(l=null==(r=s.sender)?void 0:r.first_name)?void 0:l[0],null==(i=null==(n=s.sender)?void 0:n.last_name)?void 0:i[0]]})]}),e.jsxs("div",{className:"flex flex-col max-w-[70%] "+(o?"items-end":"items-start"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:o?"You":`${null==(c=s.sender)?void 0:c.first_name} ${null==(m=s.sender)?void 0:m.last_name}`}),"admin"===(null==(d=s.sender)?void 0:d.role)&&e.jsx("span",{className:"text-xs bg-amber-100 text-amber-700 px-2 py-0.5 rounded-full",children:"Admin"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:g(new Date(s.created_at),{addSuffix:!0})})]}),e.jsx("div",{className:"rounded-lg px-3 py-2 max-w-full break-words "+(o?"bg-primary text-white":"bg-gray-100 text-gray-900"),children:s.content})]})]},s.id)}),e.jsx("div",{ref:R})]})}),e.jsxs("div",{className:"border-t p-4",children:[e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),w.trim()&&!A&&N){E(!0);try{const{error:e}=await t.from("community_messages").insert({content:w.trim(),sender_id:N.id});if(e)throw e;_("")}catch(s){d({title:"Error",description:"Failed to send message",variant:"destructive"})}finally{E(!1)}}},className:"flex gap-2",children:[e.jsx(o,{placeholder:"Type your message...",value:w,onChange:e=>_(e.target.value),disabled:A,className:"flex-1",maxLength:500}),e.jsx(c,{type:"submit",disabled:A||!w.trim(),children:e.jsx(v,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Be respectful and follow community guidelines. Messages are visible to all members."})]})]})})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs(r,{className:"w-full max-w-md",children:[e.jsx(l,{className:"text-center",children:e.jsx(n,{children:"Authentication Required"})}),e.jsxs(i,{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Please log in to access the community chat."}),e.jsx(c,{onClick:()=>window.location.href="/auth",children:"Go to Login"})]})]})})}export{N as default};
