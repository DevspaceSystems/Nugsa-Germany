import{r as e}from"./react-vendor-BPKX_lDx.js";import{u as t,s as r}from"./index-ZrmUALcR.js";function a(){const{user:a}=t(),[i,l]=e.useState(null),[s,o]=e.useState(!0),[n,f]=e.useState(null);e.useEffect(()=>{a?d():(l(null),o(!1),f(null))},[a]);const d=async()=>{if(a){o(!0),f(null);try{const{data:e,error:t}=await r.from("profiles").select("*").eq("id",a.id).single();if(t){if("PGRST116"===t.code)return void(await c());f(t.message),l(null)}else l(e)}catch(e){f("Failed to load profile"),l(null)}finally{o(!1)}}},c=async()=>{var e,t;if(a)try{const{data:i,error:s}=await r.from("profiles").insert({id:a.id,email:a.email,first_name:(null==(e=a.user_metadata)?void 0:e.first_name)||"User",last_name:(null==(t=a.user_metadata)?void 0:t.last_name)||"Name",role:"student",is_verified:!1,is_profile_complete:!1}).select().single();s?f("Failed to create profile"):l(i)}catch(i){f("Failed to create profile")}};return{profile:i,isLoading:s,error:n,refetch:d,updateProfile:async e=>{if(a)try{const{data:t,error:i}=await r.from("profiles").update(e).eq("id",a.id).select().single();if(i)throw i;return l(t),t}catch(t){throw t}}}}export{a as u};
