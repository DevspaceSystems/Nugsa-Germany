import{j as e}from"./radix-ui-BhA1LbKn.js";import{r as s}from"./react-vendor-B1bUijmx.js";import{c as t,u as a,s as i,t as r,g as l,B as n,l as c,U as d,X as o,V as m,C as h,b as x,d as u,f,e as g}from"./index-CRPRT7Ob.js";import{I as j}from"./input-BBdXW6UI.js";import{A as v,a as p,b as N}from"./avatar-C7SJqqZD.js";import{B as b}from"./badge-BBGM62l1.js";import{S as y}from"./scroll-area-CBls7toZ.js";import{E as w}from"./emoji-C2JdZYSW.js";import{P as _}from"./plus-76Qvxzeh.js";import{S as k}from"./search-B2AIdtL9.js";import{C}from"./chevron-left-CHNHAjLd.js";import{P as S}from"./play-BJ2x_dqj.js";import{I as M}from"./image-DYLKVTmU.js";import{S as D}from"./send-1-48KY2x.js";import{S as $}from"./shield-D66hZTXg.js";import{C as E}from"./clock-DBfzgY0x.js";import"./supabase-C_IPIGZD.js";import"./utils-DjG4pwKl.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=t("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),P=t("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),z=t("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),I=t("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),A=({media:t,isOpen:a,onClose:i,initialIndex:r=0})=>{const[l,c]=s.useState(r),[d,m]=s.useState(!1);s.useEffect(()=>(a?(c(r),document.body.style.overflow="hidden"):document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[a,r]);if(!a)return null;const h=t[l],x=h.endsWith(".mp4")||h.endsWith(".mov")||h.endsWith(".webm");return e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/70 text-white",children:[e.jsx(n,{variant:"ghost",size:"icon",onClick:i,className:"text-white",children:e.jsx(o,{className:"h-6 w-6"})}),e.jsxs("div",{className:"text-lg font-medium",children:[l+1," of ",t.length]}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>m(!d),className:"text-white",children:e.jsx(P,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"flex-1 relative flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:x?e.jsx("video",{src:h,controls:!0,autoPlay:!0,className:"max-h-full max-w-full object-contain"}):e.jsx("img",{src:h,alt:`Media ${l+1}`,className:"max-h-full max-w-full object-contain"})}),t.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"ghost",size:"icon",className:"absolute left-4 text-white bg-black/50 hover:bg-black/70 h-12 w-12 rounded-full",onClick:()=>{c(e=>(e-1+t.length)%t.length)},children:e.jsx(C,{className:"h-6 w-6"})}),e.jsx(n,{variant:"ghost",size:"icon",className:"absolute right-4 text-white bg-black/50 hover:bg-black/70 h-12 w-12 rounded-full",onClick:()=>{c(e=>(e+1)%t.length)},children:e.jsx(C,{className:"h-6 w-6 rotate-180"})})]})]}),d&&e.jsx("div",{className:"p-4 bg-black/70",children:e.jsx("div",{className:"grid grid-cols-4 gap-2 max-h-40 overflow-y-auto",children:t.map((s,t)=>e.jsx("div",{className:"relative aspect-square cursor-pointer border-2 "+(t===l?"border-green-500":"border-transparent"),onClick:()=>c(t),children:s.endsWith(".mp4")||s.endsWith(".mov")||s.endsWith(".webm")?e.jsxs("div",{className:"relative h-full w-full",children:[e.jsx("video",{src:s,className:"h-full w-full object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(S,{className:"h-6 w-6 text-white/80",fill:"white"})})]}):e.jsx("img",{src:s,alt:`Thumbnail ${t+1}`,className:"h-full w-full object-cover"})},t))})})]})};
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=()=>e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:e.jsxs(h,{className:"max-w-md w-full mx-auto shadow-lg",children:[e.jsxs(x,{className:"text-center pb-4",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:e.jsx($,{className:"w-8 h-8 text-blue-600"})}),e.jsx(u,{className:"text-xl font-bold text-gray-900",children:"Account Pending Approval"}),e.jsx(f,{className:"text-sm mt-2",children:"Your account is awaiting admin approval"})]}),e.jsxs(g,{className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(E,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800 mb-1",children:"What's happening?"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Your account is currently under review by our administration team. You'll be able to access all features once your account is approved."})]})]})}),e.jsx("div",{className:"text-center text-sm text-gray-600",children:e.jsx("p",{children:"Please check back later or contact support if this takes longer than expected."})})]})]})});function R(){const{user:t}=a(),{isVerified:h,loading:x}=function(){const[e,t]=s.useState(null),[a,r]=s.useState(!0),l=async()=>{try{const{data:{user:e}}=await i.auth.getUser();if(!e)return t(!1),void r(!1);const{data:s,error:a}=await i.from("profiles").select("is_verified").eq("id",e.id).single();t(!a&&((null==s?void 0:s.is_verified)||!1))}catch(e){t(!1)}finally{r(!1)}};return s.useEffect(()=>{l();const{data:{subscription:e}}=i.auth.onAuthStateChange(async(e,s)=>{"SIGNED_IN"!==e&&"USER_UPDATED"!==e||await l()});return()=>e.unsubscribe()},[]),{isVerified:e,loading:a,checkVerificationStatus:l}}(),[u,f]=s.useState([]),[g,$]=s.useState(null),[E,P]=s.useState([]),[R,T]=s.useState([]),[W,Y]=s.useState(""),[U,F]=s.useState(""),[O,V]=s.useState(!0),[B,G]=s.useState(!1),[J,K]=s.useState(!1),[H,X]=s.useState(!0),Q=s.useRef(null),[Z,ee]=s.useState([]),[se,te]=s.useState(!1),ae=s.useRef(null),ie=s.useRef(null),[re,le]=s.useState(!1),[ne,ce]=s.useState([]),[de,oe]=s.useState(0),[me,he]=s.useState(!1),[xe,ue]=s.useState(null),[fe,ge]=s.useState(!1),je=s.useRef(null);s.useEffect(()=>{je.current=g},[g]),s.useEffect(()=>{if(t&&!0===h){ye(),we();const e=ve();return()=>{e&&i.removeChannel(e),xe&&clearInterval(xe)}}t&&!1===h&&V(!1)},[t,h]);const ve=()=>{if(!t||!0!==h)return null;try{i.removeChannel(i.channel("messages-changes"));return i.channel("messages-changes").on("postgres_changes",{event:"*",schema:"public",table:"messages"},e=>{!e.new||e.new.sender_id!==t.id&&e.new.recipient_id!==t.id||(ye(),je.current&&_e(je.current))}).subscribe(e=>{"SUBSCRIBED"===e?(he(!1),xe&&(clearInterval(xe),ue(null))):"CHANNEL_ERROR"!==e&&"TIMED_OUT"!==e&&"CLOSED"!==e||(he(!0),pe())})}catch(e){return he(!0),pe(),null}},pe=s.useCallback(()=>{xe&&clearInterval(xe);const e=setInterval(()=>{t&&!0===h&&(ye(),je.current&&_e(je.current))},5e3);ue(e)},[t,h,xe]);s.useEffect(()=>{Ne()},[E]);const Ne=()=>{var e;null==(e=Q.current)||e.scrollIntoView({behavior:"smooth"})},be=e=>{const s=new Date(e),t=new Date,a=new Date(t);a.setDate(a.getDate()-1);const i=new Date(s.getFullYear(),s.getMonth(),s.getDate()),r=new Date(t.getFullYear(),t.getMonth(),t.getDate()),l=new Date(a.getFullYear(),a.getMonth(),a.getDate());return i.getTime()===r.getTime()?"Today":i.getTime()===l.getTime()?"Yesterday":s.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:s.getFullYear()!==t.getFullYear()?"numeric":void 0})},ye=async()=>{if(t&&!0===h)try{V(!0);const{data:e,error:s}=await i.from("messages").select("sender_id, recipient_id").or(`sender_id.eq.${t.id},recipient_id.eq.${t.id}`);if(s)throw s;if(!e||0===e.length)return f([]),void V(!1);const a=new Set;e.forEach(e=>{e.sender_id!==t.id&&a.add(e.sender_id),e.recipient_id!==t.id&&a.add(e.recipient_id)});const r=Array.from(a);if(0===r.length)return f([]),void V(!1);const{data:l,error:n}=await i.from("profiles").select("id, first_name, last_name, profile_image_url, is_verified").in("id",r);if(n)throw n;const c=r.map(async e=>{const{data:s,error:a}=await i.from("messages").select("\n            *,\n            sender_profile:profiles!messages_sender_id_fkey(id, first_name, last_name, profile_image_url, is_verified)\n          ").or(`and(sender_id.eq.${t.id},recipient_id.eq.${e}),and(sender_id.eq.${e},recipient_id.eq.${t.id})`).order("created_at",{ascending:!1}).limit(1).single();a&&a.code;const{count:r,error:n}=await i.from("messages").select("*",{count:"exact",head:!0}).eq("sender_id",e).eq("recipient_id",t.id).is("read_at",null),c=null==l?void 0:l.find(s=>s.id===e);return c?{contact:c,lastMessage:s||null,unreadCount:r||0}:null}),d=(await Promise.all(c)).filter(e=>null!==e);d.sort((e,s)=>{const t=e.lastMessage?new Date(e.lastMessage.created_at).getTime():0;return(s.lastMessage?new Date(s.lastMessage.created_at).getTime():0)-t}),f(d)}catch(e){r({title:"Error loading conversations",description:"Please try refreshing the page.",variant:"destructive"})}finally{V(!1)}},we=async()=>{if(!0===h)try{const{data:e,error:s}=await i.from("profiles").select("id, first_name, last_name, profile_image_url, is_verified").neq("id",(null==t?void 0:t.id)||"").order("first_name");if(s){if("42501"===s.code)return void T([]);throw s}e&&T(e)}catch(e){T([])}},_e=async e=>{if(t&&!0===h)try{const{data:s,error:a}=await i.from("messages").select("\n          *,\n          sender_profile:profiles!messages_sender_id_fkey(id, first_name, last_name, profile_image_url, is_verified)\n        ").or(`and(sender_id.eq.${t.id},recipient_id.eq.${e}),and(sender_id.eq.${e},recipient_id.eq.${t.id})`).order("created_at",{ascending:!0});if(a)throw a;s&&!a&&(P(s),await i.from("messages").update({read_at:(new Date).toISOString()}).eq("sender_id",e).eq("recipient_id",t.id).is("read_at",null),f(s=>s.map(s=>s.contact.id===e?{...s,unreadCount:0}:s)))}catch(s){}},ke=(e,s)=>{const t=e.target.files;if(!t||0===t.length)return;const a=Array.from(t).filter(e=>"image"===s?e.type.startsWith("image/"):e.type.startsWith("video/"));if(0===a.length)return void r({title:"Invalid File",description:`Please select a valid ${s} file.`,variant:"destructive"});a.filter(e=>e.size>10485760).length>0?r({title:"File Too Large",description:"Please select files smaller than 10MB.",variant:"destructive"}):(ee(e=>[...e,...a]),te(!1),e.target.value="")},Ce=async()=>{if(t&&g&&(W.trim()||0!==Z.length))if(!0===h){G(!0);try{let s=[];if(Z.length>0)try{for(const e of Z){const a=e.name.split(".").pop(),r=`${t.id}/${Date.now()}-${Math.random().toString(36).substring(2,9)}.${a}`,{error:l}=await i.storage.from("message-images").upload(r,e);if(l)throw l;const{data:{publicUrl:n}}=i.storage.from("message-images").getPublicUrl(r);s.push(n)}}catch(e){return r({title:"Media Error",description:"Failed to upload media. Please try again.",variant:"destructive"}),void G(!1)}const a={sender_id:t.id,recipient_id:g,content:W.trim(),images:s.length>0?JSON.stringify(s):null,subject:null},{data:l,error:n}=await i.from("messages").insert(a).select();if(n){if("42501"===n.code)return void r({title:"Account Not Approved",description:"Your account needs admin approval to send messages.",variant:"destructive"});throw n}Y(""),ee([]),_e(g),ye(),r({title:"Message Sent",description:"Your message has been sent successfully."})}catch(s){r({title:"Error",description:"Failed to send message. Please try again.",variant:"destructive"})}finally{G(!1)}}else r({title:"Account Not Approved",description:"Your account needs admin approval to send messages.",variant:"destructive"})},Se=R.filter(e=>`${e.first_name} ${e.last_name}`.toLowerCase().includes(U.toLowerCase())),Me=u.filter(e=>`${e.contact.first_name} ${e.contact.last_name}`.toLowerCase().includes(U.toLowerCase()));return t?x?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Checking account status..."})]})}):!1===h?e.jsx(L,{}):O?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading messages..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"h-screen flex flex-col md:flex-row",children:[e.jsxs("div",{className:(H?"flex":"hidden md:flex")+" md:w-1/3 bg-white border-r border-gray-200 flex-col w-full h-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-800 flex items-center",children:[e.jsx(l,{className:"w-5 h-5 mr-2 text-green-600"}),"Messages"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(n,{size:"sm",variant:"ghost",className:"md:hidden",children:e.jsx(c,{className:"w-4 h-4"})}),e.jsxs(n,{size:"sm",onClick:()=>K(!0),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(_,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline ml-1",children:"New"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(k,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(j,{placeholder:"Search conversations...",value:U,onChange:e=>F(e.target.value),className:"pl-10"})]})]}),e.jsx(y,{className:"flex-1",children:J?e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Start New Chat"}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>K(!1),children:"×"})]}),e.jsx("div",{className:"space-y-2",children:0===Se.length?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(d,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No contacts available"})]}):Se.map(s=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg cursor-pointer",onClick:()=>{return e=s.id,$(e),K(!1),X(!1),void _e(e);var e},children:[e.jsxs(v,{className:"w-10 h-10",children:[e.jsx(p,{src:s.profile_image_url||""}),e.jsxs(N,{children:[s.first_name[0],s.last_name[0]]})]}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 truncate",children:[s.first_name," ",s.last_name]}),s.is_verified&&e.jsx(b,{variant:"secondary",className:"text-xs",children:"Verified"})]})})]},s.id))})]}):e.jsx("div",{className:"divide-y divide-gray-100",children:0===Me.length?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(l,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No conversations yet"}),e.jsx(n,{onClick:()=>K(!0),className:"mt-2 bg-green-600 hover:bg-green-700",children:"Start a conversation"})]}):Me.map(s=>e.jsx("div",{className:"p-4 hover:bg-gray-50 cursor-pointer "+(g===s.contact.id?"bg-green-50":""),onClick:()=>{$(s.contact.id),_e(s.contact.id),X(!1)},children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(v,{className:"w-12 h-12 flex-shrink-0",children:[e.jsx(p,{src:s.contact.profile_image_url||""}),e.jsxs(N,{children:[s.contact.first_name[0],s.contact.last_name[0]]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 truncate",children:[s.contact.first_name," ",s.contact.last_name]}),s.lastMessage&&e.jsx("p",{className:"text-xs text-gray-500 flex-shrink-0 ml-2",children:be(s.lastMessage.created_at)})]}),s.lastMessage&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-600 truncate",children:[s.lastMessage.sender_id===t.id?e.jsx("span",{className:"text-green-600",children:"✓ "}):"",s.lastMessage.sender_id===t.id?"You: ":"",s.lastMessage.content]}),s.unreadCount>0&&e.jsx(b,{className:"bg-green-600 text-xs h-5 w-5 rounded-full flex items-center justify-center ml-2 flex-shrink-0",children:s.unreadCount>9?"9+":s.unreadCount})]})]})]})},s.contact.id))})})]}),e.jsx("div",{className:(H?"hidden md:flex":"flex")+" flex-1 flex-col w-full h-full",children:g?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-green-600 text-white p-3 flex items-center",children:[e.jsx(n,{variant:"ghost",size:"sm",className:"md:hidden text-white hover:bg-green-700 mr-2",onClick:()=>{X(!0),$(null)},children:e.jsx(C,{className:"w-5 h-5"})}),(()=>{var s;const t=(null==(s=u.find(e=>e.contact.id===g))?void 0:s.contact)||R.find(e=>e.id===g);return t?e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsxs(v,{className:"w-8 h-8 border border-white",children:[e.jsx(p,{src:t.profile_image_url||""}),e.jsxs(N,{className:"bg-green-700 text-white",children:[t.first_name[0],t.last_name[0]]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h2",{className:"text-lg font-medium truncate",children:[t.first_name," ",t.last_name]}),t.is_verified&&e.jsx("span",{className:"text-xs text-green-100",children:"Verified Student"})]})]}):null})(),e.jsx(n,{variant:"ghost",size:"sm",className:"text-white hover:bg-green-700",children:e.jsx(q,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 bg-green-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"space-y-2",children:[E.map((s,a)=>{const i=s.sender_id===t.id,r=0===a||be(s.created_at)!==be(E[a-1].created_at);let l=[];try{l=s.images?JSON.parse(s.images):[]}catch(c){l=[]}return e.jsxs("div",{children:[r&&e.jsx("div",{className:"flex justify-center my-4",children:e.jsx("div",{className:"bg-green-200 text-green-800 text-xs px-3 py-1 rounded-full",children:be(s.created_at)})}),e.jsx("div",{className:"flex "+(i?"justify-end":"justify-start"),children:e.jsxs("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg "+(i?"bg-green-100 text-gray-900":"bg-white text-gray-900 shadow-sm"),children:[l.length>0&&e.jsx("div",{className:"mb-2 grid gap-1 "+(1===l.length?"grid-cols-1":"grid-cols-2"),children:l.slice(0,4).map((s,t)=>e.jsxs("div",{className:"relative cursor-pointer "+(l.length>1&&3===t?"bg-black/40":""),onClick:()=>((e,s=0)=>{ce(e),oe(s),le(!0)})(l,t),children:[s.endsWith(".mp4")||s.endsWith(".mov")||s.endsWith(".webm")?e.jsxs("div",{className:"relative",children:[e.jsx("video",{src:s,className:"w-full h-auto rounded-md"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(S,{className:"h-8 w-8 text-white/80",fill:"white"})})]}):e.jsx("img",{src:s,alt:`Attachment ${t+1}`,className:"w-full h-auto rounded-md"}),l.length>4&&3===t&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40 rounded-md",children:e.jsxs("span",{className:"text-white text-lg font-bold",children:["+",l.length-3]})})]},t))}),s.content&&e.jsx("p",{className:"text-sm",children:s.content}),e.jsx("p",{className:"text-xs mt-1 text-right "+(i?"text-gray-500":"text-gray-400"),children:(n=s.created_at,new Date(n).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))})]})})]},s.id);var n}),e.jsx("div",{ref:Q})]})}),Z.length>0&&e.jsx("div",{className:"bg-white border-t border-gray-200 p-3",children:e.jsx("div",{className:"flex overflow-x-auto space-x-2 pb-2",children:Z.map((s,t)=>e.jsxs("div",{className:"relative flex-shrink-0",children:[s.type.startsWith("image/")?e.jsx("img",{src:URL.createObjectURL(s),alt:`Preview ${t}`,className:"h-16 w-16 object-cover rounded-md"}):e.jsxs("div",{className:"relative h-16 w-16",children:[e.jsx("video",{className:"h-16 w-16 object-cover rounded-md",children:e.jsx("source",{src:URL.createObjectURL(s),type:s.type})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(S,{className:"h-6 w-6 text-white/80",fill:"white"})})]}),e.jsx(n,{variant:"destructive",size:"icon",className:"absolute -top-1 -right-1 h-4 w-4 rounded-full",onClick:()=>(e=>{ee(s=>s.filter((s,t)=>t!==e))})(t),children:e.jsx(o,{className:"h-3 w-3"})})]},t))})}),e.jsx("div",{className:"bg-white border-t border-gray-200 p-3 relative",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(n,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full text-gray-500 hover:text-green-600",onClick:()=>{te(!se),ge(!1)},children:e.jsx(z,{className:"h-5 w-5"})}),se&&e.jsxs("div",{className:"absolute bottom-12 left-0 bg-white shadow-lg rounded-lg p-2 flex space-x-2 z-10 border border-gray-200",children:[e.jsx(n,{variant:"ghost",size:"icon",className:"h-12 w-12 rounded-full",onClick:()=>{var e;return null==(e=ae.current)?void 0:e.click()},children:e.jsx(M,{className:"h-6 w-6 text-green-600"})}),e.jsx(n,{variant:"ghost",size:"icon",className:"h-12 w-12 rounded-full",onClick:()=>{var e;return null==(e=ie.current)?void 0:e.click()},children:e.jsx(m,{className:"h-6 w-6 text-green-600"})})]})]}),e.jsx("input",{type:"file",ref:ae,className:"hidden",accept:"image/*",multiple:!0,onChange:e=>ke(e,"image")}),e.jsx("input",{type:"file",ref:ie,className:"hidden",accept:"video/*",multiple:!0,onChange:e=>ke(e,"video")}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(j,{value:W,onChange:e=>Y(e.target.value),placeholder:"Type a message",onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Ce())},className:"rounded-full pr-10"}),fe&&e.jsx("div",{className:"absolute bottom-12 right--1 z-20",children:e.jsx(w,{onEmojiClick:e=>{Y(s=>s+e.emoji)},width:300,height:300,previewConfig:{showPreview:!1}})})]}),e.jsx(n,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full text-gray-500 hover:text-green-600",onClick:()=>{ge(!fe),te(!1)},children:e.jsx(I,{className:"h-5 w-5"})}),e.jsx(n,{onClick:Ce,disabled:B||!W.trim()&&0===Z.length,className:"bg-green-600 hover:bg-green-700 rounded-full h-10 w-10 p-0",children:B?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(D,{className:"w-4 h-4"})})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(l,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No conversation selected"}),e.jsx("p",{className:"text-gray-600",children:"Choose a conversation from the sidebar or start a new chat"})]})})})]}),e.jsx(A,{media:ne,isOpen:re,onClose:()=>le(!1),initialIndex:de})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(l,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Sign In Required"}),e.jsx("p",{className:"text-gray-600",children:"Please sign in to access your messages."})]})})}export{R as default};
